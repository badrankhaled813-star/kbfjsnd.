Ø´<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø¥Ø¯Ø§Ø±Ø© Ù…Ø·Ø¹Ù… Ø§Ù„Ø¬Ø²ÙŠØ±Ø© - Ù†Ø¸Ø§Ù… GitHub</title>
    <style>
        /* ... Ù†ÙØ³ Ø§Ù„Ø³ØªØ§ÙŠÙ„ÙŠØ§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© Ù…Ø¹ ØªØ¹Ø¯ÙŠÙ„ Ø¨Ø³ÙŠØ· Ù„Ù„Ø£Ù„ÙˆØ§Ù† Ù„ØªÙ…ÙŠÙŠØ² Ø§Ù„Ù†Ø³Ø®Ø© ... */
        body { font-family: 'Segoe UI', sans-serif; background: #24292e; color: white; padding: 20px; direction: rtl; }
        .form-box { background: #ffffff; color: #333; padding: 25px; border-radius: 15px; max-width: 500px; margin: auto; }
        input, textarea { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 5px; }
        button { width: 100%; padding: 15px; background: #2ea44f; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        #status { text-align: center; margin-top: 10px; font-weight: bold; }
    </style>
</head>
<body>

    <div class="form-box">
        <h2>Ø¥Ø¶Ø§ÙØ© Ø·Ø¨Ù‚ (Ø¨Ø¯ÙˆÙ† Ø­Ø¯ÙˆØ¯ ğŸš€)</h2>
        <input type="text" id="itemName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø·Ø¨Ù‚">
        <input type="number" id="itemPrice" placeholder="Ø§Ù„Ø³Ø¹Ø±">
        <textarea id="itemDesc" placeholder="ÙˆØµÙ Ø§Ù„Ø·Ø¨Ù‚"></textarea>

        <label>ØµÙˆØ±Ø© Ø§Ù„Ø·Ø¨Ù‚:</label>
        <input type="file" id="itemImg" accept="image/*">

        <button id="saveBtn">Ù†Ø´Ø± Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø¹Ù„Ù‰ GitHub</button>
        <div id="status"></div>
    </div>

    <script>
        // --- Ø¥Ø¹Ø¯Ø§Ø¯Ø§ØªÙƒ Ø§Ù„Ø®Ø§ØµØ© ---
        const GITHUB_TOKEN = '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';
        const REPO_OWNER = 'badrankhaled813-star';
        const REPO_NAME = 'kbfjsnd.';
        const DATA_FILE_PATH = 'data.json';
        const IMAGE_FOLDER = 'uploads/';

        const saveBtn = document.getElementById('saveBtn');
        const status = document.getElementById('status');

        saveBtn.onclick = async () => {
            const name = document.getElementById('itemName').value;
            const price = document.getElementById('itemPrice').value;
            const desc = document.getElementById('itemDesc').value;
            const file = document.getElementById('itemImg').files[0];

            if (!name || !price || !file) return alert("ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");

            status.innerText = "Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ±Ø©...";
            saveBtn.disabled = true;

            try {
                // 1. ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© Ù„Ù€ Base64 Ù„Ø±ÙØ¹Ù‡Ø§
                const base64Img = await toBase64(file);
                const imgFileName = Date.now() + "_" + file.name;
                const imgPath = IMAGE_FOLDER + imgFileName;

                // 2. Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ù„Ù€ GitHub
                status.innerText = "Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ù„Ù€ GitHub...";
                await uploadToGithub(imgPath, base64Img.split(',')[1], `Ø±ÙØ¹ ØµÙˆØ±Ø© ${name}`);

                // 3. ØªØ­Ø¯ÙŠØ« Ù…Ù„Ù data.json
                status.innerText = "Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...";
                const currentData = await fetchCurrentData();
                const newItem = {
                    id: Date.now(),
                    name,
                    price,
                    desc,
                    image: `https://raw.githubusercontent.com/${REPO_OWNER}/${REPO_NAME}/main/${imgPath}`
                };
                currentData.push(newItem);

                const updatedJson = btoa(unescape(encodeURIComponent(JSON.stringify(currentData, null, 2))));
                await uploadToGithub(DATA_FILE_PATH, updatedJson, `Ø¥Ø¶Ø§ÙØ© Ø·Ø¨Ù‚: ${name}`, true);

                status.style.color = "green";
                status.innerText = "ØªÙ… Ø§Ù„Ù†Ø´Ø± Ø¨Ù†Ø¬Ø§Ø­! Ø³ÙŠØ¸Ù‡Ø± Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø®Ù„Ø§Ù„ Ø¯Ù‚ÙŠÙ‚Ø©.";
                setTimeout(() => location.reload(), 2000);

            } catch (err) {
                console.error(err);
                status.style.color = "red";
                status.innerText = "Ø®Ø·Ø£: " + err.message;
                saveBtn.disabled = false;
            }
        };

        async function uploadToGithub(path, content, message, isJson = false) {
            // Ù†Ø­ØªØ§Ø¬ Ø§Ù„Ù€ SHA Ù„Ùˆ Ø§Ù„Ù…Ù„Ù Ù…ÙˆØ¬ÙˆØ¯ Ø¹Ø´Ø§Ù† Ù†Ø¹Ù…Ù„ ØªØ­Ø¯ÙŠØ« (Ù„Ù„ÙÙˆÙ„Ø¯Ø± Ù„Ø§ Ù†Ø­ØªØ§Ø¬)
            let sha = "";
            if (isJson) {
                const res = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${path}`, {
                    headers: { "Authorization": `token ${GITHUB_TOKEN}` }
                });
                if (res.ok) {
                    const data = await res.json();
                    sha = data.sha;
                }
            }

            const response = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${path}`, {
                method: "PUT",
                headers: {
                    "Authorization": `token ${GITHUB_TOKEN}`,
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    message,
                    content,
                    sha: sha || undefined
                })
            });
            if (!response.ok) throw new Error("ÙØ´Ù„ Ø§Ù„Ø±ÙØ¹ Ù„Ù€ GitHub");
        }

        async function fetchCurrentData() {
            const res = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${DATA_FILE_PATH}`, {
                headers: { "Authorization": `token ${GITHUB_TOKEN}` }
            });
            if (!res.ok) return []; // Ù„Ùˆ Ø§Ù„Ù…Ù„Ù Ù…Ø´ Ù…ÙˆØ¬ÙˆØ¯ Ø§Ø¨Ø¯Ø£ Ø¨Ù…ØµÙÙˆÙØ© ÙØ§Ø¶ÙŠØ©
            const data = await res.json();
            return JSON.parse(decodeURIComponent(escape(atob(data.content))));
        }

        const toBase64 = file => new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = () => resolve(reader.result);
            reader.onerror = error => reject(error);
        });
    </script>
</body>
</html>
